---
title: "BUA 455 - Week 8_9"
subtitle: "Dashboard Project Proposal & Data Cleaning"  
author: "Penelope Pooler Eisenbies"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    seal: false
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%/%total%" 
      highlightStyle: tomorrow-night-bright
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
      keep_md: true
---

```{r setup, include=FALSE, echo=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.retina=2,
  #out.width = "75%",
  #out.height = "50%",
  htmltools.preserve.raw = FALSE,      # needed for windows
  scipen=100,                          # suppresses scientific notation
  getSymbols.warning4.0 = FALSE,       # suppresses getSymbols warnings
  cache = FALSE,
  echo = TRUE,
  hiline = TRUE,
  message = FALSE, 
  warning = FALSE
)


# install helper package (pacman)
# pacman loads and installs other packages, if needed
if (!require("pacman")) install.packages("pacman", repos = "http://lib.stat.cmu.edu/R/CRAN/")

# install and load required packages
# pacman should be first package in parentheses and then list others
pacman::p_load(pacman, tidyverse, gridExtra, magrittr, lubridate, 
               knitr, kableExtra, tidyquant, highcharter, dygraphs)

# verify packages (comment out in finished documents)
p_loaded()


```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)

palette <- c(
  SU_Orange1        = "#F76900",
  SU_Orange2        = "#FF8E00",
  SU_Red_Orange     = "#FF431B",
  SU_Blue1          = "#000E54",
  SU_Blue2          = "#203299",
  SU_Light_Blue     = "#2B72D7",
  SU_White          = "#FFFFFF",
  SU_Light_Gray     = "#ADB3B8",
  SU_Medium_Gray    = "#707780",
  SU_Black          = "#000000", 
  
  steel_blue        = "#4682B4",
  corn_flower_blue  = "#6495ED",
  deep_sky_blue     = "#00BFFF",
  dark_magenta      = "#8B008B",
  medium_orchid     = "#BA55D3",
  lime_green        = "#32CD32",
  light_sea_green   = "#20B2AA",
  chartreuse        = "#7FFF00",
  orange_red        = "#FF4500",
  white_smoke       = "#F5F5F5",
  dark_cyan         = "#008B8B",
  light_steel_blue  = "#B0C4DE",
  indigo            = "#4B0082",
  ivory             = "#FFFFF0",
  light_slate_grey  = "#778899",
  linen             = "#FAF0E6",
  steel_blue        = "#4682B4",
  blue_violet       = "#8A2BE2",
  dodger_blue       = "#1E90FF",
  light_blue        = "#ADD8E6",
  azure             = "#F0FFFF",
  lavender          = "#E6E6FA")

primary_color = "#4682B4"                # steel_blue
secondary_color = "#778899"              # light_slate_grey
white_color = "#FFFFF0"                  # ivory
black_color = "#000080"                  # navy

style_duo_accent(
  primary_color = primary_color,
  secondary_color = secondary_color,
  white_color = white_color,
  black_color = black_color,
  text_color = black_color,
  header_color = primary_color,
  background_color = white_color,
  code_inline_background_color = "#E6E6FA", # lavender
  link_color = "#1E90FF",                   # dodger_blue
  code_inline_color = "#4B0082",            # indigo
  text_bold_color = "#8B008B",              # dark_magenta
  header_font_google = google_font("Open Sans"),
  text_font_google = google_font("Open Sans"),
  code_font_google = google_font("Source Code Pro"),
  colors = palette
)


```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r xaringan-tile-view, echo=FALSE}
xaringanExtra::use_tile_view()
```

```{r xaringan-fit-screen, echo=FALSE}
xaringanExtra::use_fit_screen()
```

```{r xaringan-tachyons, echo=FALSE}
xaringanExtra::use_tachyons()
```

```{r xaringan-animate-css, echo=FALSE}
xaringanExtra::use_animate_css()
```

```{r xaringan-animate-all, echo=FALSE}
#xaringanExtra::use_animate_all("slide_up")
```

background-image: url("docs_files/images/sloth_faded.png")
background-size: cover

class: bottom, right

## BUA 455 - Weeks 8 and 9

### "Dashboard Project Proposal & Data Cleaning" 

<br>


#### Penelope Pooler Eisenbies

#### `r Sys.Date()`

[Wikipedia Sloth Page](https://en.wikipedia.org/wiki/Sloth)

---

### BUA 455 Dashboard Group Project

#### PROPOSALS and Why They are Important

- As a data analyst, you have skills that others don't.

- In this class you are learning to acquire, combine, manage, and present data

- In MAS 261, BUA 345, BUA 451 (Advanced Analytics), and additional electives, you learn to analyze and interpret data

- These skills are unique and are useful to your colleagues and clients BUT you will spend your career (over and over) selling and explaining your skill set.

- In most cases, people you work with or work for will NOT know how your skills can help them.
  
- It is your role to help them understand:

  - what questions can be answered with data

  - what data will help them answer their questions and how to get it.
  
  - How data management and analyses can help them and may likely be essential to their goals
  
---

### Where the Proposal Process fits Wthin this course
    
- The scope of this course is precisely limited to data acquisition, management, and presentation.
  
- Within that scope, there is much that can be learned from combining data sources even without analysis.
  
- Aside from this course, you will interesting and complex analytical methods that build in these skills in other courses.
  
- The more methods and concepts you know, the better prepared you are to deal with any data you encounter.
  
- BUT...No matter how much you know, the majority of you time will be spent using the skills from this course.
  
- Depending on your work environment and position, others may be assigned time consuming repetitive data management tasks by you BUT 
  
  - You should still direct the data management and presentation work because you will be held responsible.
  
<br>  
    
**File management, data management, data curation, and data presentation should all complement and augment analyses**.
  
---

#### Groups Assigned

**Proposal Rough Draft - Due Thursday, 10/26, at 5:30 PM (No Grace Period)**
   
The rough draft does not need to be more than a couple paragraphs and should answer these questions:

**What data does your group plan to work with?**

- You should have an idea of your topic (okay to be unsure and/or need guidance at pre-proposal stage)

- You should have done a little exploration

- Rough draft proposal should include ***links to specific data sources that might work.***

**What questions do you think you want to answer? **

- You can start by looking at relevant financial data and other data to brainstorm ideas.

- Database searches on **Statista** might be helpful.

  - **Statista** is a great starting point, but your project should go beyond these small curated datasets.

- **Note:** If you are interested in **sports** data or **billboard music** data and don't know how to scrape data, I can help.
  - Projects that require scraping data are doable, but data management will take more time and **you should start now**.
  
---

**Proposal Final Draft - Due Tue. 11/14, at 5:30 PM (1 Day Grace Period ONLY)**

- The final proposal draft should be 1-3 pages (double spaced, 12 pt. font). 

- In consulting, the goal of the proposal is to "sell" your skillset.

- The goal is to explain in non-technical language why your dashboard will be useful.

- You want to convince the prospective client to trust you with their data.

- It also provides a roadmap for the work you plan to do so that all group members are informed

  - List tentative goals that you hope to achieve and ideas for how to achieve them.

  - Although your client(s) are hypothetical, it helps to envision who your target client is.
    
  - How will they use the information provided in the dashboard to 
   
     - improve their marketing plan or their purchasing and staffing plan?
      
     - improve their overall investment strategy or their supply chain strategy?
      
- **UPDATE Fall 2023:** FINAL Proposal should **ALSO** include:

  - a preliminary descriptive list of your planned panels
  
  - what data will be presented in each panel, how will it tentatively be presented (which plots or tables)
  
  - Who is primarily responsible for each panel
        
---

### Proposals are **TENTATIVE** Agreements to do work

- Understandably, the work is not yet done, so your plans may change, which is okay.

- Your final plots and tables are not done, but it is good to have a pln for what they will be

  - It is actually better not to provide final proprietary work products at proposal stage.
  
  - Ideas and plots should be polished enough to entice client.

- A good proposal shows that you have creative ideas and have put some thought into how you can help the client.

- If possible show explicit links between each question or goal you plan to address and the possible component of the dashboard that addresses it.

<br>

- ***Again, it is okay if your plans change based on what you discover in the data.***

  - In real life, proposals and client goals are more concrete, but in this course, I encourage you to experiment.
  

---

### Introduction of HW 5 - Part 1 Data

#### Today: Examine and clean data

- First step is to import and examine data

- Look for quirks that might be a challenge

  - Hint: Examine `date_added` column in the .csv file or in R

```{r import netflix data and examine}

# import data and examine
nflx <- read_csv("netflix_titles.csv", show_col_types=F) |> glimpse()

```

---

### Week 8 In-class Exercises (L16 - Q1)

***Session ID: bua455f23***

How many different date formats do you see in the date_added column?

<br>

### Week 8 In-class Exercises (L16 - Q2)

***Session ID: bua455f23***

How many different commands are required to convert the date_added column to a date variable?

---

### Cleaning These Data

#### New command for dealing with text data: `separate`

#### Review of `lubridate` commands

- Next steps:
  - Select variables 
  - use separate to split `listed_in` into 3 columns (Why?)
  - Convert `date_added` to a date variable and then create a year variable
  
```{r select and do prelim variable cleaning}

nflx <- nflx |>
  select(show_id, type, date_added, release_year, rating, listed_in) |> # useful variables (subjective)

  separate(listed_in, sep=",", into=c("g1", "g2", "g3")) |>         # separate out genre listings 
                                                                    # will result in lots of NAs
  mutate(date_added = mdy(date_added),                              # convert data_added to a date var
         year_added = year(date_added))                             # create a separate year var

```

---

class: middle

### Week 8 In-class Exercises (L16 - Q3)

***Session ID: bua455f23***

`separate` is the reverse of an R command we have already learned.  What command is that?

---

### Preliminary Cleaning Completed

- The previous steps are the most basic low-hanging fruit.

- Even those steps may be edited and re-edited after looking at the data more carefully.

  - Data cleaning is almost always iterative and altered for different goals.

- For example, do we need the `show_id`?  

  - As a general rule, keep unique row identifiers (or make a simpler one) until all management work is done.
  
---

### Data Exploration and Additional Cleaning

#### Finding and Removing Data with Missing Values (Depends on Subject Matter)

- Are there observations for which `year_added` is missing (`NA`)? 
   
  - **Cool trick:** `is.na(nflx$year_added)` will create a vector of `FALSE` and `TRUE` values.
   
  - `FALSE` unless the observation value is `NA`.
   
  - R interprets `FALSE` as 0 and `TRUE` as 1 so you can sum this vector to find number of missing values.
   

```{r remove observations for which year_added is missing, results='hold'}

sum(is.na(nflx$year_added))                # number of missing values (there are 10)
table(is.na(nflx$year_added))              # could also summarize with table
nflx <- nflx |> filter(!is.na(year_added)) # remove NA's and check again
sum(is.na(nflx$year_added))

```

---

### Data Exploration and Additional Cleaning

#### Excluding **Rare** Categories (Depends on Subject Matter)

Are there observations for which rating is `NR` (not-rated) or `UR` (un-rated)?

- If so, we delete them because we are restricting our data to more common categories.
- Remainder of the categories can be grouped logically, but these are 'oddball' categories

```{r remove observations with nr or ur rating, results='hold'}

table(nflx$rating) # examine categories
nflx <- nflx |> filter(!rating %in% c("NR", "UR"))
table(nflx$rating) # examine again after filter

```

---
   
### When can you delete data?

**If you find raw uncleaned data on the internet or are given data by a client or co-worker, is it okay to delete observations?**

Yes, under certain circumstances:  

**`1.`** You must be completely transparent about how you are limiting the data and why.
  
- For example, I am limiting these data to specific time periods and specific genres.
- Other time and genre categories have too little data.
      
**`2.`** You should never delete outliers or unusual observations unless you can confirm they are errors or are not part of the data you are studying.

- I am simplifying the data by removing categories that are not of primary interest.  
- Someone else might choose different categories and limit the data differently.
- Always be transparent about data sources and all decisions you make.
   
---

### Data Exploration and Additional Cleaning

#### Modifying text or numeric variables with `ifelse`

- Numeric or text data can be converted to a categorical variable with a set of explicit `ifelse` statements.

- `ifelse` is not the ONLY way to categorize data, but it's my tool of choice.

- The input values for `ifelse` are ALWAYS the same:

  - Input 1: a test where result is `TRUE` or `FALSE`.
  - Input 2: output value if the test result is `TRUE`.
  - Input 3: output value if the test result is `FALSE`.

```{r simple example of ifelse, eval = F}

x <- seq(9,90,9)    # create var x that is a sequence of values
(d <- tibble(x))    # convert x to a tibble (dataset) 
(d <- d |> mutate(y = ifelse(x < 35, "Low", NA))) # add variable y to dataset d
(d <- d |> mutate(y = ifelse(x >= 35 & x < 65, "Medium", y))) 
(d <- d |> mutate(y = ifelse(x >= 65, "High", y)))           
```

---

### Data Exploration and Additional Cleaning

#### Modifying text multiple `ifelse` statements

- The previous example can be (and should be) condensed into one mutate statement as shown here.

```{r above example in one mutate command}
# create a dataset with 1 variable
x <- seq(9,90,9)
d <- tibble(x)
d <- d |> mutate(y = ifelse(x < 35, "Low", NA),                         
                 y = ifelse(x >= 35 & x < 65, "Medium", y),
                 y = ifelse(x >= 65, "High", y),
                 yF = factor(y, levels = c("Low", "Medium", "High"))) |> 
                              # levels option used to specify correct order
glimpse()

```

---

### Week 8 In-class Exercise

- We will examine the Netflix ratings data again and simplify the categories to reflect minimum appropriate ages.

- In this case, I have done some research on what these ratings mean.  

- In your projects, you will be expected to understand the values in your variables

  - You are likely to have to simplify your data categories for your data management goals.

- My proposed solution for these data:  

  - Categorize both TV shows and Movies into Four minimum age categories: 0, 7, 13, 17

  - Minimum Age 0: "G", "TV-G", "TV-Y"
  
  - Minimum Age 7: "PG", "TV-PG", "TV-Y7", "TV-Y7-FV"
  
  - Minimum Age 13: "PG-13", "TV-14"
  
  - Minimum Age 17: "NC-17", "TV-MA", "R"
  
---

### What we will do today:

- Together we will fill in the blanks in the R chunk below 

  - You will submit the entire chunk (with your added comments) on Blackboard in a text file.
  
  - Copy it into empty text file provided and save it with your name
  
  - This counts towards class participation for Thursday, 10/19 and due by Monday 10/23 at midnight.
  

```{r using ifelse to create min_age variable for prof, echo=F, eval=T, include=F}

#table(nflx$rating)

nflx <- nflx |>
mutate(min_age = ifelse(rating %in% c("G", "TV-G", "TV-Y"), 0, NA),
       min_age = ifelse(rating %in% c("PG", "TV-PG", "TV-Y7", "TV-Y7-FV"), 7, min_age),
       min_age = ifelse(rating %in% c("PG-13", "TV-14"), 13, min_age),
       min_age = ifelse(rating %in% c("NC-17", "TV-MA", "R"), 17, min_age))

#table(nflx$min_age)

```


```{r using ifelse to create min_age variable}

table(nflx$rating)

# nflx <- nflx |>
#   mutate(min_age = ifelse(rating %in% c("G", "TV-G", "TV-Y"), 0, ____),
#          min_age = ifelse(rating %in% c("PG", "TV-PG", "TV-Y7", "TV-Y7-FV"), 7, _____),
#          min_age = ifelse(rating %in% c("PG-13", "TV-14"), ____, ____),
#          min_age = ifelse())

# table(nflx$min_age)

```

---

#### Another `ifelse` Example

- We can use a similar technique to categorize when shows or movies were first shown (released).

- This code is very similar to our simple numerical example shown previously.

- In HW 5 (which will be posted **EARLY NEXT WEEK**) you will:

  - Filter data to remove releases from before 1981
  

```{r categorizing release data into periods}

#table(nflx$release_year)

nflx <- nflx |>
  mutate(release_period = ifelse(release_year <= 1980, "1925-1980", NA),
         release_period = ifelse(release_year > 1980 & release_year <= 2000, "1981-2000", release_period),
         release_period = ifelse(release_year > 2000 & release_year <= 2005, "2001-2005", release_period),
         release_period = ifelse(release_year > 2005 & release_year <= 2010, "2006-2010", release_period),
         release_period = ifelse(release_year > 2010 & release_year <= 2015, "2011-2015", release_period),
         release_period = ifelse(release_year > 2015, "2016-2021", release_period))

table(nflx$release_period)

```

---

### Cleaning Text Variables

- The code that follows **WILL NOT RUN** until the `min_age` and `release_period` variables are created (previous chunks).

- The next steps are tedious, but important, and will be different for every dataset you encounter.

- On a quiz you should know how to use these text commands: 

  - `gsub`, `str_trim`, 
  
  - `separate`, `paste`, 
  
  - `tolower`, `toupper`,
  
  - `ifelse` which is also used elsewhere
  
<br>
  
  - Not required but useful: use `str_trim` to see also `str_squish` and `str_pad`

---

### Week 9 In-class Exercises (L18 - Q1)

***Session ID: bua455f23***

`str_trim` is used in an upcoming chunk to trim spaces before characters in some observations.

Can `gsub` also be used for this purpose?

<br>

### Week 9 In-class Exercises (L18 - Q2)

***Session ID: bua455f23***

Type `?tolower` into the console to bring up the help file for this command and `toupper`.

Copy and paste these lines into the console:

```
tolower("WhAT is the Result of this Command?")

toupper("WhAT is the Result of this Command?")

```

---

### Multi-step Process to clean genre

- Reshape data with `pivot_longer` and convert all text to lower case with `to_lower`

- Examine in console using this command: `cbind(table(nflx$genre))`

```{r cleaning up genre}

nflx <- nflx |>
  select(show_id, type, year_added, release_period, min_age, g1, g2, g3) |>
  pivot_longer(cols=c("g1","g2","g3"), names_to="g", values_to="genre") 
                                                 # g is a place holder

nflx <- nflx |> select(!g) |> mutate(genre=tolower(genre)) |> glimpse()

```

---

### Multi-step Process to clean genre

.pull-left[

- Remove leading spaces with `str_trim`

- Examine in console using this command: `cbind(table(nflx$genre))`

```{r remove leading spaces}

# remove leading space
nflx <- nflx |> mutate(genre = str_trim(genre))

```


]

.pull-right[

![](docs_files/images/owl.png)

]



---

### Remove Unnecessary Text

- This text is unnecessary and redundant because of `type` variable in data.

- Examine in console using this command: `cbind(table(nflx$genre))`

```{r remove movies tv shows and tv text}

# remove the text `movies` and `tv shows` and `tv` from genre names
nflx <- nflx |>
  mutate(genre = gsub(" movies", "", genre),
         genre = gsub("movies", "", genre),
         genre = gsub(" tv shows", "", genre),
         genre = gsub("tv shows", "", genre),
         genre = gsub("tv ", "", genre),
         genre = gsub(" tv", "", genre))

```

---

### Consolidate `genre` Categories using `ifelse`

- Below I am only editing and consolidating categories I plan to use.

- Examine in console using this command: `cbind(table(nflx$genre))`

```{r consolidate and edit genres of interest}
nflx <- nflx |>
  mutate(genre = ifelse(genre == "drama", "dramas", genre),
         
         genre = ifelse(genre %in% c("stand-up comedy", 
                                     "stand-up comedy & talk shows"), 
                        "comedies", genre),

         genre = ifelse(genre %in% c("documentaries", "docuseries"), 
                        "docs", genre),
         
         genre = ifelse(genre %in% c("children & family", "kids'"), 
                        "kids", genre),

         genre = gsub("action & adventure", "action_adventr", genre))

```

---

### Filter Data to Genres of Interest

.pull-left[

- Examine in console using this command: `cbind(table(nflx$genre))`

- Examine in console using this command: `table(nflx$type, nflx$genre)`

```{r filter data to six genres we have consolidated}

nflx <- nflx |>
  filter(genre %in% c("action_adventr", "comedies", "docs", 
                      "dramas", "international", "kids"))

```

]

.pull-right[

![](docs_files/images/owl.png)

]



---

### Create Final Summary Dataset

In HW 5 - Part 1, Students will create and use `nflx_mv`, the movies observations from these data.

```{r create final summary dataset}

nflx <- nflx |>                            
  group_by(type, release_period, year_added, min_age, genre) |>
  summarize(n = n()) |>                   # n() tallies number of obs       
  pivot_wider(id_cols = c(type, release_period, year_added, min_age), # col. for each genre
              names_from = genre, 
              values_from = n)

nflx[is.na(nflx)] <- 0                                          # why should NA's be 0 here?
nflx_tv <- nflx |>                                              # example dashboard  made from nflx tv
  filter(type == "TV Show") 

# nflx_mv <- 

```

---

### Tuesday (10/31) Short group meetings with me

.pull-left[

- I will post a schedule (randomly assigned)

- After reading your submitted pre-proposal I will:

  - Ask your group questions 
  
  - Provide feedback to guide you towards good data and a good plan 
  
  - Answer question you might have before you write your final proposal.

]

.pull-right[

![](docs_files/images/owl.png)

]


  
---

background-image: url("docs_files/images/tired_panda_faded.png")
background-size: cover


.pull-left[

### **Key Points from Weeks 8 & 9**

.bg-azure.b--dark_cyan.ba.bw2.br3.shadow-5.ph2[

**Group Dashboard Project**

- Project Proposals: 
  - Rough Draft due Thu. 10/26 at 5:30 PM
  - Final Draft due Mon. 11/14 at 5:30 PM

- Data Exploration and Cleaning

  - Iterative process
  - Involves some subjectivity
  - Always be transparent 
  - Carefully document choices

- Introduction to HW 5 - Part 1
  - Due Fri. 11/3 at midnight
  - Grace Period Ends Tuesday 11/7
  
- Quiz 2 on Thu. 11/9

]

]

.pull-right[


.bg-azure.b--dark_cyan.ba.bw2.br3.shadow-5.ph3[
You may submit an 'Engagement Question' about each lecture until midnight on the day of the lecture. **A minimum of four submissions are required during the semester.**
]


]



